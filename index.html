<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">PDF Master - Free PDF Tools</title>
    <meta name="description" content="Free online PDF tools. Merge, split, compress PDF files. All processing in browser using pdf-lib.">
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7/download.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --bg: #0f172a; --bg2: #1e293b; --card: #334155; --text: #f8fafc; --text2: #94a3b8; --accent: #ef4444; --success: #10b981; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }
        .lang { position: fixed; top: 15px; right: 15px; z-index: 1000; }
        .lang-btn { background: var(--card); border: 1px solid rgba(255,255,255,0.1); color: var(--text); padding: 8px 14px; border-radius: 20px; cursor: pointer; font-size: 0.85rem; }
        .lang-dropdown { position: absolute; top: 100%; right: 0; margin-top: 8px; background: var(--card); border-radius: 12px; display: none; min-width: 140px; overflow: hidden; }
        .lang-dropdown.show { display: block; }
        .lang-option { padding: 10px 14px; cursor: pointer; }
        .lang-option:hover { background: var(--bg2); }
        .header { text-align: center; padding: 40px 20px; background: var(--bg2); }
        .header h1 { font-size: 2.5rem; background: linear-gradient(135deg, var(--accent), #f97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; }
        .header p { color: var(--text2); }
        .nav-tabs { display: flex; justify-content: center; gap: 10px; padding: 20px; background: var(--bg2); flex-wrap: wrap; position: sticky; top: 0; z-index: 100; }
        .nav-tab { padding: 10px 20px; background: transparent; border: 2px solid transparent; color: var(--text2); border-radius: 25px; cursor: pointer; font-weight: 500; }
        .nav-tab:hover { color: var(--text); background: rgba(255,255,255,0.05); }
        .nav-tab.active { color: var(--accent); border-color: var(--accent); background: rgba(239,68,68,0.1); }
        .container { max-width: 900px; margin: 0 auto; padding: 30px 20px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .tool-card { background: var(--bg2); border-radius: 16px; padding: 30px; margin-bottom: 20px; }
        .tool-title { font-size: 1.5rem; margin-bottom: 10px; }
        .tool-desc { color: var(--text2); margin-bottom: 25px; }
        .upload-area { border: 3px dashed rgba(255,255,255,0.2); border-radius: 16px; padding: 50px 20px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--accent); background: rgba(239,68,68,0.05); }
        .upload-area.dragover { border-color: var(--accent); background: rgba(239,68,68,0.1); }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s; margin: 5px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: var(--card); color: var(--text); border: 2px solid rgba(255,255,255,0.1); }
        .file-list { background: var(--card); border-radius: 10px; padding: 15px; margin: 20px 0; max-height: 200px; overflow-y: auto; }
        .file-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .file-item button { background:none;border:none;color:#ef4444;cursor:pointer;font-size:1.2rem; }
        .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--success); color: white; padding: 12px 24px; border-radius: 25px; opacity: 0; transition: all 0.3s; z-index: 1000; }
        .toast.error { background: #ef4444; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .progress { background: var(--card); border-radius: 10px; padding: 15px; margin: 20px 0; text-align: center; display: none; }
        .progress.show { display: block; }
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.3s; }
        .input-field { width: 100%; background: var(--card); border: 2px solid transparent; border-radius: 10px; padding: 12px; color: var(--text); margin-top: 8px; }
        .input-field:focus { outline: none; border-color: var(--accent); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .page-info { background: var(--card); padding: 15px; border-radius: 10px; margin: 15px 0; }
        @media (max-width: 600px) { .grid-2 { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="lang">
        <button class="lang-btn" onclick="toggleLang()"><span id="flag">üá∫üá∏</span> <span id="langName">English</span> ‚ñº</button>
        <div class="lang-dropdown" id="langDropdown">
            <div class="lang-option" onclick="setLang('en')">üá∫üá∏ English</div>
            <div class="lang-option" onclick="setLang('zh')">üá®üá≥ ‰∏≠Êñá</div>
            <div class="lang-option" onclick="setLang('es')">üá™üá∏ Espa√±ol</div>
            <div class="lang-option" onclick="setLang('ja')">üáØüáµ Êó•Êú¨Ë™û</div>
            <div class="lang-option" onclick="setLang('ko')">üá∞üá∑ ÌïúÍµ≠Ïñ¥</div>
        </div>
    </div>

    <header class="header">
        <h1 data-i18n="title">üìÑ PDF Master</h1>
        <p data-i18n="subtitle">Free Online PDF Tools - Merge, Split, Compress</p>
    </header>

    <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('merge')" data-i18n="tabMerge">üìé Merge</button>
        <button class="nav-tab" onclick="switchTab('split')" data-i18n="tabSplit">‚úÇÔ∏è Split</button>
        <button class="nav-tab" onclick="switchTab('compress')" data-i18n="tabCompress">üóúÔ∏è Compress</button>
    </nav>

    <div class="container">
        <!-- Merge -->
        <div id="merge-section" class="section active">
            <div class="tool-card">
                <h2 class="tool-title" data-i18n="mergeTitle">üìé Merge PDF Files</h2>
                <p class="tool-desc" data-i18n="mergeDesc">Combine multiple PDFs into one. Select files in desired order.</p>
                
                <div class="upload-area" id="mergeDropZone" onclick="document.getElementById('mergeInput').click()">
                    <p style="font-size: 3rem">üìé</p>
                    <p data-i18n="dropText">Click or drag PDF files here</p>
                    <input type="file" id="mergeInput" accept=".pdf" multiple style="display:none" onchange="handleMergeFiles(event)">
                </div>

                <div class="file-list" id="mergeList" style="display:none"></div>
                
                <div class="progress" id="mergeProgress">
                    <p data-i18n="processing">Processing...</p>
                    <div class="progress-bar"><div class="progress-fill" id="mergeProgressBar"></div></div>
                </div>

                <div style="text-align:center;margin-top:20px">
                    <button class="btn btn-primary" id="mergeBtn" onclick="mergePDFs()" data-i18n="mergeBtn">üìé Merge PDFs</button>
                </div>
            </div>
        </div>

        <!-- Split -->
        <div id="split-section" class="section">
            <div class="tool-card">
                <h2 class="tool-title" data-i18n="splitTitle">‚úÇÔ∏è Split PDF</h2>
                <p class="tool-desc" data-i18n="splitDesc">Extract specific pages from PDF.</p>
                
                <div class="upload-area" id="splitDropZone" onclick="document.getElementById('splitInput').click()">
                    <p style="font-size: 3rem">‚úÇÔ∏è</p>
                    <p data-i18n="dropText">Click or drag PDF file here</p>
                    <input type="file" id="splitInput" accept=".pdf" style="display:none" onchange="handleSplitFile(event)">
                </div>

                <div id="splitOptions" style="display:none;margin-top:20px">
                    <div class="page-info">
                        <p id="totalPages" style="color:var(--text2)"></p>
                    </div>
                    
                    <div class="grid-2">
                        <div>
                            <label data-i18n="fromPage">From Page:</label>
                            <input type="number" class="input-field" id="fromPage" value="1" min="1">
                        </div>
                        <div>
                            <label data-i18n="toPage">To Page:</label>
                            <input type="number" class="input-field" id="toPage" value="1" min="1">
                        </div>
                    </div>
                    
                    <div class="progress" id="splitProgress">
                        <p data-i18n="processing">Processing...</p>
                    </div>
                    
                    <div style="text-align:center;margin-top:20px">
                        <button class="btn btn-primary" id="splitBtn" onclick="splitPDF()" data-i18n="splitBtn">‚úÇÔ∏è Split PDF</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compress -->
        <div id="compress-section" class="section">
            <div class="tool-card">
                <h2 class="tool-title" data-i18n="compressTitle">üóúÔ∏è Compress PDF</h2>
                <p class="tool-desc" data-i18n="compressDesc">Optimize PDF by removing duplicate objects and compressing streams.</p>
                
                <div class="upload-area" id="compressDropZone" onclick="document.getElementById('compressInput').click()">
                    <p style="font-size: 3rem">üóúÔ∏è</p>
                    <p data-i18n="dropText">Click or drag PDF file here</p>
                    <input type="file" id="compressInput" accept=".pdf" style="display:none" onchange="handleCompressFile(event)">
                </div>

                <div id="compressInfo" style="display:none;margin-top:20px">
                    <div class="page-info">
                        <p id="compressFileInfo" style="color:var(--text2)"></p>
                    </div>
                    
                    <div class="progress" id="compressProgress">
                        <p data-i18n="processing">Processing...</p>
                    </div>
                    
                    <div style="text-align:center;margin-top:20px">
                        <button class="btn btn-primary" id="compressBtn" onclick="compressPDF()" data-i18n="compressBtn">üóúÔ∏è Compress PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const { PDFDocument } = PDFLib;
        
        const i18n = {
            en: { 
                title: 'üìÑ PDF Master', subtitle: 'Free Online PDF Tools - Merge, Split, Compress', 
                tabMerge: 'üìé Merge', tabSplit: '‚úÇÔ∏è Split', tabCompress: 'üóúÔ∏è Compress',
                mergeTitle: 'üìé Merge PDF Files', mergeDesc: 'Combine multiple PDFs into one. Select files in desired order.',
                splitTitle: '‚úÇÔ∏è Split PDF', splitDesc: 'Extract specific pages from PDF.',
                compressTitle: 'üóúÔ∏è Compress PDF', compressDesc: 'Optimize PDF by removing duplicate objects.',
                dropText: 'Click or drag PDF files here', fromPage: 'From Page:', toPage: 'To Page:',
                mergeBtn: 'üìé Merge PDFs', splitBtn: '‚úÇÔ∏è Split PDF', compressBtn: 'üóúÔ∏è Compress PDF',
                processing: 'Processing...', done: '‚úÖ Done! Downloading...', error: '‚ùå Error: ',
                selectFiles: 'Select at least 2 PDF files', selectFile: 'Please select a PDF file',
                invalidRange: 'Invalid page range', pages: ' pages'
            },
            zh: { 
                title: 'üìÑ PDF Â§ßÂ∏à', subtitle: 'ÂÖçË¥πÂú®Á∫ø PDF Â∑•ÂÖ∑ - ÂêàÂπ∂„ÄÅÊãÜÂàÜ„ÄÅÂéãÁº©',
                tabMerge: 'üìé ÂêàÂπ∂', tabSplit: '‚úÇÔ∏è ÊãÜÂàÜ', tabCompress: 'üóúÔ∏è ÂéãÁº©',
                mergeTitle: 'üìé ÂêàÂπ∂ PDF Êñá‰ª∂', mergeDesc: 'Â∞ÜÂ§ö‰∏™ PDF ÂêàÂπ∂‰∏∫‰∏Ä‰∏™Êñá‰ª∂„ÄÇÊåâÈ°∫Â∫èÈÄâÊã©Êñá‰ª∂„ÄÇ',
                splitTitle: '‚úÇÔ∏è ÊãÜÂàÜ PDF', splitDesc: '‰ªé PDF ‰∏≠ÊèêÂèñÁâπÂÆöÈ°µÈù¢„ÄÇ',
                compressTitle: 'üóúÔ∏è ÂéãÁº© PDF', compressDesc: 'ÈÄöËøáÁßªÈô§ÈáçÂ§çÂØπË±°‰ºòÂåñ PDF„ÄÇ',
                dropText: 'ÁÇπÂáªÊàñÊãñÊãΩ PDF Êñá‰ª∂Âà∞ËøôÈáå', fromPage: '‰ªéÁ¨¨Âá†È°µ:', toPage: 'Âà∞Á¨¨Âá†È°µ:',
                mergeBtn: 'üìé ÂêàÂπ∂ PDF', splitBtn: '‚úÇÔ∏è ÊãÜÂàÜ PDF', compressBtn: 'üóúÔ∏è ÂéãÁº© PDF',
                processing: 'Â§ÑÁêÜ‰∏≠...', done: '‚úÖ ÂÆåÊàêÔºÅÊ≠£Âú®‰∏ãËΩΩ...', error: '‚ùå ÈîôËØØÔºö',
                selectFiles: 'ËØ∑Ëá≥Â∞ëÈÄâÊã© 2 ‰∏™ PDF Êñá‰ª∂', selectFile: 'ËØ∑ÈÄâÊã©‰∏Ä‰∏™ PDF Êñá‰ª∂',
                invalidRange: 'Êó†ÊïàÁöÑÈ°µÁ†ÅËåÉÂõ¥', pages: ' È°µ'
            },
            es: {
                title: 'üìÑ PDF Master', subtitle: 'Herramientas PDF Gratuitas - Unir, Dividir, Comprimir',
                tabMerge: 'üìé Unir', tabSplit: '‚úÇÔ∏è Dividir', tabCompress: 'üóúÔ∏è Comprimir',
                mergeTitle: 'üìé Unir Archivos PDF', mergeDesc: 'Combina m√∫ltiples PDFs en uno solo.',
                splitTitle: '‚úÇÔ∏è Dividir PDF', splitDesc: 'Extrae p√°ginas espec√≠ficas del PDF.',
                compressTitle: 'üóúÔ∏è Comprimir PDF', compressDesc: 'Optimiza PDF eliminando objetos duplicados.',
                dropText: 'Haz clic o arrastra archivos PDF aqu√≠', fromPage: 'Desde p√°gina:', toPage: 'Hasta p√°gina:',
                mergeBtn: 'üìé Unir PDFs', splitBtn: '‚úÇÔ∏è Dividir PDF', compressBtn: 'üóúÔ∏è Comprimir PDF',
                processing: 'Procesando...', done: '‚úÖ ¬°Listo! Descargando...', error: '‚ùå Error: ',
                selectFiles: 'Selecciona al menos 2 archivos PDF', selectFile: 'Selecciona un archivo PDF',
                invalidRange: 'Rango de p√°ginas inv√°lido', pages: ' p√°ginas'
            },
            ja: {
                title: 'üìÑ PDF „Éû„Çπ„Çø„Éº', subtitle: 'ÁÑ°Êñô„Ç™„É≥„É©„Ç§„É≥ PDF „ÉÑ„Éº„É´ - ÁµêÂêà„ÄÅÂàÜÂâ≤„ÄÅÂúßÁ∏Æ',
                tabMerge: 'üìé ÁµêÂêà', tabSplit: '‚úÇÔ∏è ÂàÜÂâ≤', tabCompress: 'üóúÔ∏è ÂúßÁ∏Æ',
                mergeTitle: 'üìé PDF „Éï„Ç°„Ç§„É´„ÇíÁµêÂêà', mergeDesc: 'Ë§áÊï∞„ÅÆ PDF „Çí 1 „Å§„Å´„Åæ„Å®„ÇÅ„Åæ„Åô„ÄÇ',
                splitTitle: '‚úÇÔ∏è PDF „ÇíÂàÜÂâ≤', splitDesc: 'PDF „Åã„ÇâÁâπÂÆö„ÅÆ„Éö„Éº„Ç∏„ÇíÊäΩÂá∫„Åó„Åæ„Åô„ÄÇ',
                compressTitle: 'üóúÔ∏è PDF „ÇíÂúßÁ∏Æ', compressDesc: 'ÈáçË§á„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÇíÂâäÈô§„Åó„Å¶ PDF „ÇíÊúÄÈÅ©Âåñ„Åó„Åæ„Åô„ÄÇ',
                dropText: '„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ PDF „Éï„Ç°„Ç§„É´„Çí„Éâ„É©„ÉÉ„Ç∞', fromPage: 'ÈñãÂßã„Éö„Éº„Ç∏:', toPage: 'ÁµÇ‰∫Ü„Éö„Éº„Ç∏:',
                mergeBtn: 'üìé PDF „ÇíÁµêÂêà', splitBtn: '‚úÇÔ∏è PDF „ÇíÂàÜÂâ≤', compressBtn: 'üóúÔ∏è PDF „ÇíÂúßÁ∏Æ',
                processing: 'Âá¶ÁêÜ‰∏≠...', done: '‚úÖ ÂÆå‰∫ÜÔºÅ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ‰∏≠...', error: '‚ùå „Ç®„É©„ÉºÔºö',
                selectFiles: 'PDF „Éï„Ç°„Ç§„É´„Çí 2 „Å§‰ª•‰∏äÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ', selectFile: 'PDF „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
                invalidRange: 'ÁÑ°Âäπ„Å™„Éö„Éº„Ç∏ÁØÑÂõ≤', pages: ' „Éö„Éº„Ç∏'
            },
            ko: {
                title: 'üìÑ PDF ÎßàÏä§ÌÑ∞', subtitle: 'Î¨£Î£å Ïò®ÎùºÏù∏ PDF ÎèÑÍµ¨ - Î≥ëÌï©, Î∂ÑÌï†, ÏïïÏ∂ï',
                tabMerge: 'üìé Î≥ëÌï©', tabSplit: '‚úÇÔ∏è Î∂ÑÌï†', tabCompress: 'üóúÔ∏è ÏïïÏ∂ï',
                mergeTitle: 'üìé PDF ÌååÏùº Î≥ëÌï©', mergeDesc: 'Ïó¨Îü¨ PDFÎ•º ÌïòÎÇòÎ°ú Í≤∞Ìï©Ìï©ÎãàÎã§.',
                splitTitle: '‚úÇÔ∏è PDF Î∂ÑÌï†', splitDesc: 'PDFÏóêÏÑú ÌäπÏ†ï ÌéòÏù¥ÏßÄÎ•º Ï∂îÏ∂úÌï©ÎãàÎã§.',
                compressTitle: 'üóúÔ∏è PDF ÏïïÏ∂ï', compressDesc: 'Ï§ëÎ≥µ Í∞ùÏ≤¥Î•º Ï†úÍ±∞ÌïòÏó¨ PDFÎ•º ÏµúÏ†ÅÌôîÌï©ÎãàÎã§.',
                dropText: 'ÌÅ¥Î¶≠ ÎòêÎäî PDF ÌååÏùº ÎìúÎûòÍ∑∏', fromPage: 'ÏãúÏûë ÌéòÏù¥ÏßÄ:', toPage: 'ÎÅù ÌéòÏù¥ÏßÄ:',
                mergeBtn: 'üìé PDF Î≥ëÌï©', splitBtn: '‚úÇÔ∏è PDF Î∂ÑÌï†', compressBtn: 'üóúÔ∏è PDF ÏïïÏ∂ï',
                processing: 'Ï≤òÎ¶¨ Ï§ë...', done: '‚úÖ ÏôÑÎ£å! Îã§Ïö¥Î°úÎìú Ï§ë...', error: '‚ùå Ïò§Î•ò: ',
                selectFiles: 'PDF ÌååÏùºÏùÑ 2Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî', selectFile: 'PDF ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî',
                invalidRange: 'Ïú†Ìö®ÌïòÏßÄ ÏïäÏùÄ ÌéòÏù¥ÏßÄ Î≤îÏúÑ', pages: ' ÌéòÏù¥ÏßÄ'
            }
        };

        let currentLang = localStorage.getItem('lang') || 'en';
        let mergeFiles = [];
        let splitPdfDoc = null;
        let splitFileName = '';
        let compressPdfDoc = null;
        let compressFileName = '';

        // Initialize
        setLang(currentLang);
        setupDragDrop();

        function setLang(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            const flags = {en: 'üá∫üá∏', zh: 'üá®üá≥', es: 'üá™üá∏', ja: 'üáØüáµ', ko: 'üá∞üá∑'};
            const names = {en: 'English', zh: '‰∏≠Êñá', es: 'Espa√±ol', ja: 'Êó•Êú¨Ë™û', ko: 'ÌïúÍµ≠Ïñ¥'};
            document.getElementById('flag').textContent = flags[lang];
            document.getElementById('langName').textContent = names[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (i18n[lang][key]) el.textContent = i18n[lang][key];
            });
            document.title = i18n[lang].title;
            document.getElementById('langDropdown').classList.remove('show');
        }

        function toggleLang() { document.getElementById('langDropdown').classList.toggle('show'); }
        document.addEventListener('click', e => { if (!e.target.closest('.lang')) document.getElementById('langDropdown').classList.remove('show'); });

        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.className = 'toast' + (isError ? ' error' : '');
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(tab + '-section').classList.add('active');
        }

        function setupDragDrop() {
            ['mergeDropZone', 'splitDropZone', 'compressDropZone'].forEach(id => {
                const zone = document.getElementById(id);
                zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('dragover'); });
                zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
                zone.addEventListener('drop', e => {
                    e.preventDefault();
                    zone.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (id === 'mergeDropZone' && files.length > 0) {
                        mergeFiles = Array.from(files).filter(f => f.type === 'application/pdf');
                        updateMergeList();
                    } else if (id === 'splitDropZone' && files.length === 1) {
                        handleSplitFile({ target: { files: [files[0]] } });
                    } else if (id === 'compressDropZone' && files.length === 1) {
                        handleCompressFile({ target: { files: [files[0]] } });
                    }
                });
            });
        }

        // ==================== MERGE ====================
        function handleMergeFiles(e) {
            mergeFiles = Array.from(e.target.files);
            updateMergeList();
        }

        function updateMergeList() {
            const list = document.getElementById('mergeList');
            if (mergeFiles.length === 0) { list.style.display = 'none'; return; }
            list.innerHTML = mergeFiles.map((f, i) => `
                <div class="file-item">
                    <span>${i+1}. ${f.name} (${(f.size/1024).toFixed(1)} KB)</span>
                    <button onclick="removeFile(${i})" title="Remove">‚úï</button>
                </div>
            `).join('');
            list.style.display = 'block';
        }

        function removeFile(i) { 
            mergeFiles.splice(i, 1); 
            updateMergeList(); 
        }

        async function mergePDFs() {
            if (mergeFiles.length < 2) { 
                showToast(i18n[currentLang].selectFiles, true); 
                return; 
            }

            const btn = document.getElementById('mergeBtn');
            const progress = document.getElementById('mergeProgress');
            const progressBar = document.getElementById('mergeProgressBar');
            
            btn.disabled = true;
            progress.classList.add('show');
            
            try {
                const mergedPdf = await PDFDocument.create();
                
                for (let i = 0; i < mergeFiles.length; i++) {
                    const file = mergeFiles[i];
                    const fileBytes = await file.arrayBuffer();
                    const pdf = await PDFDocument.load(fileBytes);
                    const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    pages.forEach(page => mergedPdf.addPage(page));
                    
                    progressBar.style.width = ((i + 1) / mergeFiles.length * 100) + '%';
                }
                
                const mergedPdfBytes = await mergedPdf.save();
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                download(blob, 'merged.pdf', 'application/pdf');
                
                showToast(i18n[currentLang].done);
            } catch (error) {
                showToast(i18n[currentLang].error + error.message, true);
            } finally {
                btn.disabled = false;
                progress.classList.remove('show');
                progressBar.style.width = '0%';
            }
        }

        // ==================== SPLIT ====================
        async function handleSplitFile(e) {
            const file = e.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                showToast(i18n[currentLang].selectFile, true);
                return;
            }
            
            try {
                const fileBytes = await file.arrayBuffer();
                splitPdfDoc = await PDFDocument.load(fileBytes);
                splitFileName = file.name.replace('.pdf', '');
                
                const totalPages = splitPdfDoc.getPageCount();
                document.getElementById('totalPages').textContent = 
                    i18n[currentLang].totalPages?.replace('{0}', totalPages) || `Total: ${totalPages} pages`;
                document.getElementById('fromPage').value = 1;
                document.getElementById('toPage').value = totalPages;
                document.getElementById('toPage').max = totalPages;
                document.getElementById('splitOptions').style.display = 'block';
            } catch (error) {
                showToast(i18n[currentLang].error + error.message, true);
            }
        }

        async function splitPDF() {
            if (!splitPdfDoc) return;
            
            const fromPage = parseInt(document.getElementById('fromPage').value);
            const toPage = parseInt(document.getElementById('toPage').value);
            const totalPages = splitPdfDoc.getPageCount();
            
            if (fromPage < 1 || toPage > totalPages || fromPage > toPage) {
                showToast(i18n[currentLang].invalidRange, true);
                return;
            }
            
            const btn = document.getElementById('splitBtn');
            const progress = document.getElementById('splitProgress');
            
            btn.disabled = true;
            progress.classList.add('show');
            
            try {
                const newPdf = await PDFDocument.create();
                const pages = await newPdf.copyPages(splitPdfDoc, 
                    Array.from({length: toPage - fromPage + 1}, (_, i) => fromPage - 1 + i));
                pages.forEach(page => newPdf.addPage(page));
                
                const pdfBytes = await newPdf.save();
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                download(blob, `${splitFileName}_pages_${fromPage}-${toPage}.pdf`, 'application/pdf');
                
                showToast(i18n[currentLang].done);
            } catch (error) {
                showToast(i18n[currentLang].error + error.message, true);
            } finally {
                btn.disabled = false;
                progress.classList.remove('show');
            }
        }

        // ==================== COMPRESS ====================
        async function handleCompressFile(e) {
            const file = e.target.files[0];
            if (!file || file.type !== 'application/pdf') {
                showToast(i18n[currentLang].selectFile, true);
                return;
            }
            
            try {
                const fileBytes = await file.arrayBuffer();
                compressPdfDoc = await PDFDocument.load(fileBytes);
                compressFileName = file.name.replace('.pdf', '');
                
                const originalSize = (file.size / 1024).toFixed(1);
                document.getElementById('compressFileInfo').textContent = 
                    `Original: ${originalSize} KB | ${compressPdfDoc.getPageCount()} pages`;
                document.getElementById('compressInfo').style.display = 'block';
            } catch (error) {
                showToast(i18n[currentLang].error + error.message, true);
            }
        }

        async function compressPDF() {
            if (!compressPdfDoc) return;
            
            const btn = document.getElementById('compressBtn');
            const progress = document.getElementById('compressProgress');
            
            btn.disabled = true;
            progress.classList.add('show');
            
            try {
                // Optimize PDF by using object streams and compressing
                const pdfBytes = await compressPdfDoc.save({
                    useObjectStreams: true,
                    addDefaultPage: false,
                    preserveExistingEncryption: false
                });
                
                const blob = new Blob([pdfBytes], { type: 'application/pdf' });
                const newSize = (blob.size / 1024).toFixed(1);
                download(blob, `${compressFileName}_compressed.pdf`, 'application/pdf');
                
                showToast(i18n[currentLang].done + ` (${newSize} KB)`);
            } catch (error) {
                showToast(i18n[currentLang].error + error.message, true);
            } finally {
                btn.disabled = false;
                progress.classList.remove('show');
            }
        }
    </script>
</body>
</html>
